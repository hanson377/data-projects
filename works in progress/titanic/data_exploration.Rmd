---
title: "Quick Exploration of Classic Titanic Dataset"
output:
  github_document:
    fig_width: 9
    fig_height: 4
---


## Load packages and data
Simply loading the packages we will need for this exercise as well as the data we will need.

```{r load-packages and data, message = FALSE, echo = FALSE}
library(ggplot2)
library(dplyr)
library(statsr)
library(DescTools)
library(InformationValue)

data <- read.csv("C:/Users/hanso/OneDrive/Documents/GitHub/data-projects/titanic/train.csv")
```


## Exploratory data analysis
Lets begin by looking at survival rates for some variables that I think might show us something interesting.

```{r initial survival rates, echo = FALSE}
data %>% group_by(Pclass) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(Sex) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(Embarked) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(Parch) %>% summarise(mean = mean(Survived), sample = n())

data %>% group_by(Parch) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(SibSp) %>% summarise(mean = mean(Survived), sample = n())

data <- data %>% mutate(
    parch2 = case_when(Parch == 0 ~ 0,
                      Parch > 0 ~ 1))
  data <- data %>% mutate(
      sib2 = case_when(SibSp == 0 ~ 0,
                        SibSp > 0 ~ 1))
data <- data %>% mutate(embark_alt = case_when(Embarked == "C" ~ "C", Embarked == "Q" ~ "Other", Embarked == "S" ~ "Other"))

data %>% group_by(parch2) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(sib2) %>% summarise(mean = mean(Survived), sample = n())
data %>% group_by(embark_alt) %>% summarise(mean = mean(Survived), sample = n())
```

## A few quick observations
All of the above seem to vary greatly by different levels.  
We will want to include these in our modeling efforts.

Now, lets look at the relationship between survival rates and some continuous variables

```{r survival by continuous variables}
data %>% group_by(Survived) %>% summarise(mean = mean(Fare), median(Fare), iqr = IQR(Fare))
ggplot(data=data, aes(x=factor(Survived), y=Fare)) + geom_boxplot() + theme(legend.position = 'bottom')
ggplot(data=data, aes(x=factor(Survived), y=Age)) + geom_boxplot() + theme(legend.position = 'bottom')

ggplot(data=data, aes(x=Fare, fill=factor(Sex))) + geom_density() + theme(legend.position = 'bottom')
ggplot(data=data, aes(x=Fare, fill=factor(Survived))) + geom_density() + facet_wrap(~ factor(Sex)) + theme(legend.position = 'bottom')
```

## A quick observation
From the above, it seems pretty clear your odds of survival were depending on your fare amount.


```{r more analysis}
data %>% group_by(Survived) %>% summarise(mean = mean(Age, na.rm=TRUE), median(Age,na.rm=TRUE), iqr = IQR(Age,na.rm=TRUE))
ggplot(data=data, aes(x=factor(Survived), y=Age)) + geom_boxplot() + theme(legend.position = 'bottom')
ggplot(data=data, aes(x=Fare, fill=factor(Embarked))) + geom_density() + theme(legend.position = 'bottom')
ggplot(data=data, aes(x=Fare, colour=factor(Embarked))) + stat_ecdf() + theme(legend.position = 'bottom')

ggplot(data = data, aes(x=Fare)) + geom_histogram() + facet_wrap(~Survived) + theme(legend.position = 'bottom')
ggplot(data = data, aes(x=Fare, fill=sib2)) + geom_density() + facet_wrap(~Survived) + theme(legend.position = 'bottom')
```


Finally, lets look at the cabin field. seems we have a lot of nulls. lets fill those in with "unknown"

```{r cleaning data}
data <- data %>% mutate(cabin_alt = case_when(
        Cabin == "" ~ 'no value',
        Cabin %like% "A" ~ "A",
        Cabin %like% "B" ~ "B",
        Cabin %like% "C" ~ "C",
        Cabin %like% "D" ~ "D",
        Cabin %like% "E" ~ "E",
        Cabin %like% "F" ~ "F",
        Cabin %like% "G" ~ "G",
        Cabin %like% "T" ~ "T"
))
data %>% group_by(cabin_alt) %>% summarise(mean = mean(Survived), sample = n())


data <- data %>% mutate(cabin2 = case_when (
Cabin == "" ~ "no value OR A/G/F",
Cabin %like% "A" ~ "no value OR A/G/F",
Cabin %like% "G" ~ "no value OR A/G/F",
Cabin %like% "F" ~ "no value OR A/G/F",
Cabin %like% "B" ~ "Other",
Cabin %like% "C" ~ "Other",
Cabin %like% "D" ~ "Other",
Cabin %like% "E" ~ "Other",
Cabin %like% "T" ~ "Other"
))
data %>% group_by(cabin2) %>% summarise(mean = mean(Survived), sample = n())
```

Looks like we have something here.  
People with a designated cabin seem to have much higher survival rates.

## Model Building
Now, let us build a very simple model with what we learned from above. We will begin by creating some training and test data.  Below, we create the training and test data.

```{r creating training and test data}
input_ones <- data[which(data$Survived == 1), ]  # all 1's
input_zeros <- data[which(data$Survived == 0), ]  # all 0's
set.seed(100)  # for repeatability of samples
input_ones_training_rows <- sample(1:nrow(input_ones), 0.7*nrow(input_ones))  # 1's for training
input_zeros_training_rows <- sample(1:nrow(input_zeros), 0.7*nrow(input_ones))  # 0's for training. Pick as many 0's as 1's
training_ones <- input_ones[input_ones_training_rows, ]
training_zeros <- input_zeros[input_zeros_training_rows, ]
trainingData <- rbind(training_ones, training_zeros)  # row bind the 1's and 0's

test_ones <- input_ones[-input_ones_training_rows, ]
test_zeros <- input_zeros[-input_zeros_training_rows, ]
testData <- rbind(test_ones, test_zeros)  # row bind the 1's and 0's
```

Now that we have some data, lets begin building our model using our findings from above and condition it with the training data.

```{r run model}
fit1 <- glm(Survived ~ factor(Pclass) + factor(embark_alt) + factor(Sex) + factor(cabin2) + Fare, data = trainingData, family = "binomial")
summary(fit1)
```
